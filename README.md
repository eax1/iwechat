# iwechat
微信全网最全SDK解决方案, 全网最终极参考.
抄袭此文的人，请解释下什么是 微信的turing检测，以及 Android协议伴生(Companion)模式 究竟是什么架构.

### 微信SDK全方案对比

|   方案        |   功能完整性  |   安全性    |  扩展性     | 技术门槛 |   成本                                                                |
:----------------------------------------------------------------------| :---------------------------| :------------------------| :-------------------------------------------------------------------------| :-------| :------|
| WEB版微信+JSHOOK       |   低(*)       | 低(*)     |  低(*)  | 低(*) | 低(*)     |
| 模拟点击方案/辅助功能     | 低(*)     | 高(*) | 低(*) | 低(*) | 中(*)
| iOS Substrate         |   高(****)   | 低(*)      | 中(**) | 中(**) | 高(***) |
| iOS/Android重签名包        |   高(****)    | 低(*)     | 中(***)| 低(*)   | 低(*) |
| Android模拟器 + Hook   |   高(****)    | 低(*)     | 高(****)  | 中(**) | 低(*) |
| Android Xposed + ROOT |   高(****)   | 低(*)     |  高(****)  | 中(**) | 高(***)   |
| Android免ROOT + 平行空间 |   高(****)    | 高(*)     | 低(*)     | 中(**) | 高(***)   |
| 变种Xposed + ROOT/magisk |   高(****)    | 低(*)      |  高(****)  | 中上(***) | 高(***)   |
| 变种Xposed + 定制ROM   |   高(****)   | 高(****)   |  高(****)  |  高(****) | 高(***)   |
| Mac/iPad协议          |   中上(***)   | 中(**)    | 中(**) | 中上(***) | 低(*)
| PC协议                |   中(**)      | 高(****)  | 中(**) | 中上(***) | 中(**)
| Android协议伴生(Companion)模式  |   高(****)   | 高(****) | 高(****) | 高(****) | 低(*)

下面一一介绍每种方式的优劣：
### 1. WEB版微信 + JSHOOK
原因：功能受限，无法大规模上号，实现简单，比如 [wechaty](https://github.com/wechaty) 等早期主要就是基于 WEB版微信来做的SDK. 基本已经淘汰的方式.

### 2. 模拟点击方案/辅助功能 
模拟点击方案，商业工具有比如 触动精灵，触摸精灵，autojs等。免root一般要开启 辅助功能. 主要用于养号，加粉操作等。
目前发现 [有机云](https://www.yjiyun.com/) 等产品采用此方案. 对于消息收发各方面操作效率低下，也无法拦截底层数据.

### 3. iOS Substrate
一般早期的灰产，黑产，做群控云控的，HOOK接62数据登录，结合改机 + 模拟操作做批量任务。商业用途中使用比较少. 主要原因一来越狱的没落，二来新设备成本昂贵.

### 4. iOS/Android重签名包
早期的微商多开，基本使用此方式，非常容易被识别。基本也被淘汰的方式。

### 5. Android模拟器 + HOOK
用云端Android模拟器 或 机柜阵列，HOOK方案. 难点在于真机运行时的伪造，以及GPS/IP/基站的分布. 
此方案无法很有效对抗微信的图灵检测.

### 6. Android Xposed + ROOT
先前中国几乎全部SCRM类商业系统均采用的方案，包括不限于 [虎赞](51zan.com)(6.18被腾讯全线封杀，现在转型做企业微信)，[聚客通](www.juketool.com)，[艾客](http://www.aiagain.com), [奥创](https://mobilegate.cn/).
微信2019-06-18基于xposed检测干掉了此类企业大量运营微信账号. 后期部分厂商逐步转型到 Xposed变种以及 Xposed变种+定制ROM方案. 目前已经是高危方案.

### 7. Android免ROOT + VA
应用层方案，用Virtual App, DroidPlugin等作宿主，去托管运行微信APK，进行父应用对子应用的inject hook, 方案相对安全。但是运行态体验对用户不友好，也有一些检测点泄漏问题存在.

### 8. 变种Xposed + ROOT/magisk
xposed被封杀之后，大量的变种xposed诞生，用于对抗xposed特征检测，无法有效覆盖so层面的反检测，没有解决ROOT白名单等根源性问题. 此方案迟早被彻底干翻.

### 9. 变种Xposed + 自定义ROM
解决ROOT白名单问题，提供给微信等APP安全运行时，暴露可检测点相对少。。在后续的持续对抗中，微信会逐步深入挖掘并完善检测点。 (qianhu.wejianzhan.com) 等微商手机也采用此方案。

### 10. Mac/iPad协议
免设备轻量级解决方案，听起来很性感。但是协议级无法完全模拟真机行为，在资源调度上也是难点，无法仿真环境。也无法对抗turing检测。 一般用于 消耗型产品比如淘宝客推广，或者个人工具型如 清粉软件，群管理软件等。少量SCRM也在使用。。包括不限于 [句子秒回](https://www.botorange.com/), [酷客](www.kukr.com) 等. 此方案存在系统级风险，一旦托管微信号过多，可能最后会存在大面积封杀.

### 11. PC协议
对PC微信的运行时内存进行动态修改和读取，以完成诸如收发信息等操作. 方案的安全性比较高。功能受限于微信PC版。扩展性方面，在云端Window虚拟机一对一进行账户托管，有一定的成本。当需要扩展其他协议时，可以把PC方案当作混合方案的基础方案，在朋友圈，加粉等协议上，追加 iPad/Mac协议/Android协议做补充.
目前 类似 [Wetool](https://www.wxb.com/wetool) 等PC聚合聊天工具，采取的此方案.

### 12. Android协议伴生(Companion)模式
笔者总结下来的免入侵最佳方案，基本可以保证设备免ROOT，且功能性，成本等各方面最优。也是目前难度系数最大的方案。
需要在so层面整体剖析并平行运行部分协议. 目前全网除笔者以外，没有看到任何一家此方案的实现者.

总结下来：
1. 消耗型，比如加粉类，淘宝客类，ROI高的黑产灰产黄赌毒类产业，会选择成本低，安全性适中的方案。
2. 运营型产业，比如SCRM，聊天IM等商家工具。会选择成本中高，安全性高的方案。
3. 规模越大，对安全性和可扩展性要求越高。

扩展:
[技术商业篇](./技术商业篇.md)

如果是微信生态深度从业者，可加微信: supercatxp